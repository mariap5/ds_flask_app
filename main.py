import codecs

from Crypto.Signature import DSS, __all__, pkcs1_15
from cryptography import x509
from cryptography.hazmat.primitives import hashes, serialization
from cryptography.hazmat.primitives.asymmetric.padding import OAEP, MGF1, PKCS1v15, PSS
from cryptography.hazmat.primitives.serialization import load_pem_private_key

from Crypto.PublicKey import RSA
from Crypto.Hash import SHA256

certificate = '''-----BEGIN CERTIFICATE-----
MIIDwDCCAqigAwIBAgIRAPkBZMjG60A8tCEm1SGj7yUwDQYJKoZIhvcNAQELBQAw
GjEYMBYGA1UEAwwPTGljZW50YSBFVFRJIENBMB4XDTIyMDUwNDAyMzEyNVoXDTI0
MDgwNzAyMzEyNVowgbUxCzAJBgNVBAYTAlJPMRIwEAYDVQQHDAlCdWNoYXJlc3Qx
EDAOBgNVBAgMB1JvbWFuaWExGzAZBgNVBAkMEnN0cmFkYSBzdHVkZW50dWx1aTEd
MBsGA1UECgwUTGljZW50YSBFVFRJIFN0dWRlbnQxJTAjBgkqhkiG9w0BCQEWFnN0
dWRlbnQuZXR0aUB5YWhvby5jb20xHTAbBgNVBAMMFHd3dy5zdHVkZW50LWV0dGku
Y29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA6L6/OvGIQHCsIYUT
mSe5oDTvjsrxbrnwMUqnhv1Du72U4UpZHYVmG4V0VC8pEsGN02Vta0BbsdwA+fee
kWWy3QpKo/bY0oXmh+frtf5tiQeq/6otyb07NXdUUJu6GvaJtIaW6B3AV7iTbKtG
21zfZfnp+PIO/nozB3O8CMFcWHCZBuWufK/9qF/6ubrPFrGi7IbirQL648Rpcw/0
POf57lnPpAJ0CWRFnS+PJKewGuxgbHT4agRWMiXG4WMXrQpP3grwJAHyX8H/whBp
ejjC43yM0bMliIVlL2x3cm+l6x4OMYXUSTL16huzky1K9FpUrap56pWOzvbe5YAN
dO6F6wIDAQABo2UwYzAfBgNVHREEGDAWghR3d3cuc3R1ZGVudC1ldHRpLmNvbTAO
BgNVHQ8BAf8EBAMCBeAwDwYDVR0TAQH/BAUwAwEB/zAfBgNVHSMEGDAWgBT6l7yN
epXFCUBwKyYBpkP0tghRFDANBgkqhkiG9w0BAQsFAAOCAQEAQU93nb6QH27GUSiY
cB+ehpjTtMfWwN/A+slcTKM8agfnr9guUzl1D4P3D+BpEWyPzNrVHFpCMcpzlYRd
3tFapPFnI2KLIzC3uLumxSxCst79Y7swqDapZUgqCT5XZBEZ6VNOPIiAruJgVUTC
R7bnQGyV38AekYEGsQC/EuMXyPOqxlwU+pEWb6EpkLNXTD5ptZGSaAbzZxlIoWWM
fbivslcU1dc4aQYj1g3Z7jfKrzK2uuSXmKkn000LE1ZbzQndZAxoWeZ9OMICz6WF
U+gPK3RML1pzrR8xR0qR9locSibVfcF9BuDcN+UUiVaF1RLoRiHWJl/GHw7nTJXw
14/akQ==
-----END CERTIFICATE-----'''
# signature = "wKVJljCdCL97GzZgTRLHjWmEqvfhNrYwcS8fRRgSMab7htHfXDh1b4aeXXMgyJIYXif9+H0rFbVZP2aFiEj3ZgEq7cc/96TPB8g3+NvlsQ6c5fYpSfPG1j3Kwi2GsAMetTn97nLhzNJOQocqqLYY7sh59o/k2iDvKABSvanU7tlEEo86X+h7prhhXFC58N2RFJ437QU6ZDnYohs4xD7GeJ4iBsWD7Jb41374eMrxxEXiM12NwWItOmbyq10i52yTpaeLGAquJYyWnR4HOGqQJ/YtoxrPDTZIYuaxX8g1QCUzTRsQZmJopU7NYXffhUw3+YNpeg46o0mmL2caxOtV6g=="
challenge = 'asdf'
cert = x509.load_pem_x509_certificate(bytes(certificate, 'utf-8'))
private_key = '''-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEA6L6/OvGIQHCsIYUTmSe5oDTvjsrxbrnwMUqnhv1Du72U4UpZ
HYVmG4V0VC8pEsGN02Vta0BbsdwA+feekWWy3QpKo/bY0oXmh+frtf5tiQeq/6ot
yb07NXdUUJu6GvaJtIaW6B3AV7iTbKtG21zfZfnp+PIO/nozB3O8CMFcWHCZBuWu
fK/9qF/6ubrPFrGi7IbirQL648Rpcw/0POf57lnPpAJ0CWRFnS+PJKewGuxgbHT4
agRWMiXG4WMXrQpP3grwJAHyX8H/whBpejjC43yM0bMliIVlL2x3cm+l6x4OMYXU
STL16huzky1K9FpUrap56pWOzvbe5YANdO6F6wIDAQABAoIBAQC7nyELRDABOpMY
Rm3hFewG4QWIx8LO7udY5QSdxka27oI5BzVFngcNAo0fXBExRISvOGF3hx8kBuVm
nJ3gOepxU92Nxe1N8JFBV81lHeBxCZRom2hj677yP+rhPFhPahTiSWkXXvxx+qIl
hQEOzxRr4YYioAdET4AZbsvTBwUJaNn0KbCjQRzbgkxB6d7d6cOeWZi4K5j/l7rD
YIn0xBff8h37VcqhxeBh3SWV8srOMFw9un/vFbVuBSJpxRQf8qoCQ15HzWC+7CL0
+ZD8/24OQTtFayxYKygyg2LE6nHPtDrgsRayIfg4TROQiJT7OvUvlZJ1/HpG3NjJ
JPH9R/l5AoGBAPXjoP9T6mumX04+X/1uVtCAreHb08QvdnXjMLuVPbWDlEZh9FT/
XGnkZ6ZbD3Dz3lQvQthpFSnTBK614isOeuR6mMP7irlpJP2qZypmBHUAG6YRNmX8
2uoMAtT7NB1ggXu/JcG+x1Eb0Z/vlMnHs+n7fpAqBo1LKgQVJdFIHDvNAoGBAPJQ
wYwxgnjjzck168SFq+WJaislGYTZWcmfWjE9WMA0H16tXOqWVW+sy4laJeQKQuMu
d2AtLTvZki4LKpDZASgT+cUuu5eCj5Ej2Gn+eDcz0w6oTi7KROjnQskoHyEp8hv8
XV8cRWGCHU28PWxm7cqBleHWJ+si0uYiIjbGpECXAoGAQ5CAtKgCSgI1PfK1vZWM
FU7GeMFGtymzi0EaKvEfO7kkDRLtaE2ivxYbxQJQg+D+vnMeEwkM36k0KC2iL+KS
siVdxLxhqgDSQUGJh4TwxJV7A27HW87W+GjEfnFoKIpUCgTEAzDA4/CY8TGL2MYf
EbQhWsuxcTGuIeENuyvtViECgYAAg5FVhclcDkeidJ3SZeIuc3MpMkPyly9skQz0
68djaPjkD4QR702xFfG8kddgu3DW4INaTd45sUVxGY72ja9F8XznISk+sgUx7pyH
5QVGQLLi5hJ8YOtyfwMSQCaIwHkF/CwKhpnTEh6TyqFquHEqq8mwl+6vvfwqhsoB
ybwRcwKBgEFtGlZOlapg6ybLRbm8uvoH6MEtTdQ3w+H/MZuM2D3QAojPPSLaJwoH
EYA3e4qZkQUfN1sdj1gqbb9B4DsjvZECs0yfvEXi9aHAyblL+YvqqR2yewf1+U1g
wbT2USJF2Zw1SxoWnbCtgRS7/i3wFl3uga6Yg3mz1mV3few1aOyo
-----END RSA PRIVATE KEY-----'''
signature = 'c0a54996309d08bf7b1b36604d12c78d6984aaf7e136b630712f1f45181231a6fb86d1df5c38756f869e5d7320c892185e27fdf87d2b15b5593f66858848f766012aedc73ff7a4cf07c837f8dbe5b10e9ce5f62949f3c6d63dcac22d86b0031eb539fdee72e1ccd24e42872aa8b618eec879f68fe4da20ef280052bda9d4eed944128f3a5fe87ba6b8615c50b9f0dd91149e37ed053a6439d8a21b38c43ec6789e2206c583ec96f8d77ef878caf1c445e2335d8dc1622d3a66f2ab5d22e76c93a5a78b180aae258c969d1e07386a9027f62da31acf0d364862e6b15fc8354025334d1b10666268a54ecd6177df854c37f983697a0e3aa349a62f671ac4eb55ea'
message = b'asdf'

public_key = cert.public_key().public_bytes(serialization.Encoding.PEM, serialization.PublicFormat.SubjectPublicKeyInfo)
openssl_pub = '''-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA6L6/OvGIQHCsIYUTmSe5
oDTvjsrxbrnwMUqnhv1Du72U4UpZHYVmG4V0VC8pEsGN02Vta0BbsdwA+feekWWy
3QpKo/bY0oXmh+frtf5tiQeq/6otyb07NXdUUJu6GvaJtIaW6B3AV7iTbKtG21zf
Zfnp+PIO/nozB3O8CMFcWHCZBuWufK/9qF/6ubrPFrGi7IbirQL648Rpcw/0POf5
7lnPpAJ0CWRFnS+PJKewGuxgbHT4agRWMiXG4WMXrQpP3grwJAHyX8H/whBpejjC
43yM0bMliIVlL2x3cm+l6x4OMYXUSTL16huzky1K9FpUrap56pWOzvbe5YANdO6F
6wIDAQAB
-----END PUBLIC KEY-----'''
print(openssl_pub == public_key)
hash = SHA256.new(message)
crypto_public_key = RSA.import_key(openssl_pub)
crypto_private_key = RSA.import_key(private_key)

print("salut")

signer = pkcs1_15.new(crypto_private_key)
signature_result = signer.sign(hash)
print(codecs.encode(signature_result, "hex"))
print(signature_result)
verifier = pkcs1_15.new(crypto_public_key)
print(signature.encode("utf8"))

js_encrypt_signature = b"wKVJljCdCL97GzZgTRLHjWmEqvfhNrYwcS8fRRgSMab7htHfXDh1b4aeXXMgyJIYXif9+H0rFbVZP2aFiEj3ZgEq7cc/96TPB8g3+NvlsQ6c5fYpSfPG1j3Kwi2GsAMetTn97nLhzNJOQocqqLYY7sh59o/k2iDvKABSvanU7tlEEo86X+h7prhhXFC58N2RFJ437QU6ZDnYohs4xD7GeJ4iBsWD7Jb41374eMrxxEXiM12NwWItOmbyq10i52yTpaeLGAquJYyWnR4HOGqQJ/YtoxrPDTZIYuaxX8g1QCUzTRsQZmJopU7NYXffhUw3+YNpeg46o0mmL2caxOtV6g=="
verifier.verify(hash, codecs.decode(js_encrypt_signature, "base64"))
# print("salut")

print(codecs.decode(js_encrypt_signature, "base64"))